{% extends "admin/base_site.html" %}

<!-- LOADING -->
{% load adminmedia admin_list i18n grp_tags %}

<!-- JAVASCRIPTS -->
{% block javascripts %}
    {{ block.super }}
    {% if cl.formset %}
        {% url admin:jsi18n as jsi18nurl %}
        <script type="text/javascript" src="{{ jsi18nurl|default:'../../jsi18n/' }}"></script>
    {% endif %}
    {{ media }}
    
<script type="text/javascript">
    (function($) {
        
        function initializeFlexibleLayout(content) {
            $('#content').addClass('content-flexible');
            $(content).find('.span-flexible').next('.column').parent().addClass('layout-flexible-grid');
            $(content).find('.column').next('.span-flexible').parent().addClass('layout-grid-flexible');
            $(content).append('<br clear="all" />');
            // Layout Flexible + Grid
            if ($(content).hasClass('layout-flexible-grid')) {
                var SpanGrid = $(content).find('.span-flexible').next('.column').outerWidth();
                var PaddingRight = SpanGrid + 20;
                var MarginRight = - SpanGrid - 20;
                $(content).css({
                    'padding-right': PaddingRight
                });
                $(content).find('.span-flexible').next('.column').css({
                    'margin-right': -10000
                });
            }
            // Layout Grid + Flexible
            if ($(content).hasClass('layout-grid-flexible')) {
                var SpanGrid = $(content).find('.span-flexible').prev('.column').outerWidth();
                var PaddingLeft = SpanGrid + 20;
                var MarginLeft = - SpanGrid - 20;
                $(content).css({
                    'padding-left': PaddingLeft
                });
                $(content).find('.span-flexible').prev('.column').css({
                    'margin-left': MarginLeft
                });
            }
        };
        
        function HorizontalOverflow(content) {
            var TableWidth = $(content).find('table').outerWidth();
            var SpanFlexibleWidth = $(content).find('.span-flexible').outerWidth();
            if (TableWidth > SpanFlexibleWidth) {
                $(content).find('.span-flexible').css({
                    'min-width' : TableWidth + 1 + 'px'
                });
                $(content).find('.span-flexible').next('.column').css({
                    'border-right' : '20px solid transparent'
                });
            }
            if (TableWidth < SpanFlexibleWidth) {
                $(content).find('.span-flexible').css({
                    'min-width': 'auto'
                });
            }
        };
        
        function ModifyTableElements() {
            // UGLY HACK: add no-wrap to table-elements
            // should be there already.
            $('.changelist-results a.add-another').parent().addClass('nowrap');
        };
        
        $(document).ready(function() {
            initializeFlexibleLayout('.container-flexible');
            
            // jQuery UI Datepicker
            // $(".vDateField").datepicker({
            //     showOn: 'button', 
            //     buttonImageOnly: false, 
            //     buttonText: ''
            // });
            
            $('.toggle-filter').click(function(){
                $(this).toggleClass('selected');
                $('.filter-container').toggle();
            });
            
            $(".filter_choice").change(function(){
                location.href = $(this).val();
            });
            
            if ($("input.action-select").length > 0) {
                $("input.action-select").actions();
            }
            // hide the last coll if its an editable list
            // because this coll has just the hidden input with the id (breaks ui)
            
            if ($("#changelist").hasClass("editable")) {
                // UGLY HACK: add th for thead when list_editables are activated.
                // why is the th missing anyway??? f*ck.
                $(".changelist-results tr").each(function() {
                    $(this).find("td:last").hide();
                });
            }
            
            $("div#filter h2").click(function() {
                $(this).next().toggle();
            })
            
            $("h4#filter-handler").click(function() {
                $("div#filters").toggle();
            })
            
            $("a#search-handler").click(function() {
                $("div.search-container").toggle();
            })
            
            $("input#action-toggle").click(function() {
                var selected = $("input[name='_selected_action']:checked").length;
                if (selected) {
                    // $("div#footer_general").hide();
                    $("div#footer_submit").hide();
                    $("div#footer_actions").show();
                } else {
                    // $("div#footer_general").show();
                    $("div#footer_submit").hide();
                    $("div#footer_actions").hide();
                }
            })
            $("input[name='_selected_action']").click(function() {
                var selected = $("input[name='_selected_action']:checked").length;
                if (selected) {
                    // $("div#footer_general").hide();
                    $("div#footer_submit").hide();
                    // $("div#footer_actions").show();
                } else {
                    // $("div#footer_general").show();
                    $("div#footer_submit").hide();
                    // $("div#footer_actions").hide();
                }
            })
            $("input[name!='_selected_action'][id!='action-toggle']").click(function() {
                // $("div#footer_general").hide();
                $("div#footer_submit").show();
                // $("div#footer_actions").hide();
            })
            
            $("a.cancel-link").click(function() {
                // $("div#footer_general").show();
                $("div#footer_submit").hide();
                // $("div#footer_actions").hide();
            })
            
            $("a.toggle-filters").click(function() {
                $(".filter-pulldown").toggle();
            })
            
            {% if is_popup %}
            // UGLY HACK: REMOVE ACTIONS and LIST_EDITABLES FOR POPUPS
            // shouldn't be there in the first place, see
            // http://code.djangoproject.com/ticket/11700
            $('div#actions').hide();
            $('input.action-select').parent().hide();
            $('input#action-toggle').parent().hide();
            $('div.changelist-results input').attr('disabled', 'disabled');
            $('div#submit').hide();
            {% endif %}
            
        });
        
        $(window).resize(function(){
            HorizontalOverflow('.container-flexible');
        });
        window.onload = function () {
            HorizontalOverflow('.container-flexible');
        }
    })(jQuery.noConflict());
</script>
    
{% endblock %}

<!-- COLTYPE/BODYCLASS-- >
{% block bodyclass %}change-list{% endblock %}
{% block content-class %}content-flexible{% endblock %}

<!-- BREADCRUMBS -- >
{% block breadcrumbs %}
{% if not is_popup %}
    <div id="breadcrumbs">
        <a href="../../">{% trans "Home" %}</a> &rsaquo;
        <a href="../">{{ app_label|capfirst }}</a> &rsaquo;
        {{ cl.opts.verbose_name_plural|capfirst }}
    </div>
{% endif %}
{% endblock %}

<!-- CONTENT-TITLE -->
{% block content_title %}
    <h1>
        {{ cl.opts.verbose_name_plural|capfirst }}
    </h1>
{% endblock %}

<!-- OBJECT-TOOLS -->
{% block object-tools %}
    {% if has_add_permission %}
        <ul class="tools">
            <li>
                <a href="add/{% if is_popup %}?_popup=1{% endif %}" class="focus">
                    Add
                </a>
            </li>
        </ul>
    {% endif %}
{% endblock %}

<!-- CONTENT -->
{% block content %}

{% if search_form or cl.date_hierarchy or cl.has_filters %}
<div class="module">
    <div class="Xform-row">
        {% pagination cl %}
        {% if cl.has_filters %}
            <div id="filters" class="box filter">
                <a href="javascript://" class="toggle-filters">{% trans 'Filter' %}</a>
                <div class="filter-pulldown">
                    {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}
                </div>
            </div>
        {% endif %}
        {% if not search_form %}
            <div id="search" class="box search">
                {% block search %}{% search_form cl %}{% endblock %}
            </div>
        {% endif %}
        <br clear="all" />
    </div>
    {% if cl.date_hierarchy %}
    <div id="date-hierarchy">
        {% date_hierarchy cl %}
    </div>
    {% endif %}
</div>
{% endif %}

<form action="" method="post"{% if cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}>{% csrf_token %}

<div id="actions">
{% admin_actions %}
</div>

<div id="changelist" class="container-full{% if cl.list_editable %} editable{% endif %}" style="">
    <!-- Popup Hidden Field -->
    {% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
    <!-- Errors -->
    {% if cl.formset.errors %}
        <p class="errornote">
            {% blocktrans count cl.formset.errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
        </p>
        {{ cl.formset.non_form_errors }}
    {% endif %}
    <!-- Management Form -->
    {% if cl.formset %}
        {{ cl.formset.management_form }}
    {% endif %}
    <div class="group changelist-content">
        {% block result_list %}
            {% result_list cl %}
        {% endblock %}
    </div>
</div><br clear="all" />

<div class="module">
    <div class="form-row">
        {% pagination cl %}
    </div>
</div>

{% if cl.formset and cl.result_count %}
<div id="submit" class="module footer" style="display: none;">
    <ul class="submit-row">
        <li class="left delete-link-container"><a href="javascript://" class="cancel-link">Cancel</a></li>
        <li class="submit-button-container"><input type="submit" class="default" value="Save"/></li>
    </ul>
</div>
{% endif %}

</form>


{% endblock %}
