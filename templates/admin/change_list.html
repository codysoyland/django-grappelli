{% extends "admin/base_site.html" %}

{% load adminmedia admin_list i18n %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% load adminmedia %}{% admin_media_prefix %}css/changelist.css" />
{% endblock %}

{% block extrahead %}
    <script type="text/javascript" src="{% admin_media_prefix %}js/getElementsBySelector.js"></script>
    {% if cl.formset %}
        <script type="text/javascript" src="../../jsi18n/"></script>
    {% endif %}
    {# <script type="text/javascript" src="{% admin_media_prefix %}js/admin/CollapsedFiltersets.js"></script> #}
    {{ media }}
    {% if not actions_on_top and not actions_on_bottom %}
    <style>
        #changelist table thead th:first-child {width: inherit}
    </style>
    {% endif %}
    
    <script type="text/javascript">
        function HorizontalOverflow() {
            var TableWidth = $('table').outerWidth();
            var ContentWidth = $('.changelist-content').outerWidth();
            if (TableWidth > ContentWidth) {
                $('#changelist.module.filtered').css({
                    'padding-right' : 227
                });
                $('.changelist-content').css({
                    'min-width' : TableWidth+1+'px'
                });
                $('#changelist-filter').css({
                    'border-right' : '15px solid #fff'
                });
            }
            if (TableWidth < ContentWidth) {
                $('#changelist.module.filtered').css({
                    'padding-right' : 210
                });
                $('.changelist-content').css({
                    'min-width' : auto
                });
                $('#changelist-filter').css({
                    'border-right' : 0
                });
            }
        };
        $(window).resize(function(){
            HorizontalOverflow();
        });
        window.onload = function () {
            HorizontalOverflow();
        }
        $(document).ready(function(){
            
            // TICKET #11447: td containing a.add-another need.nowrap
            $('table').find('a.add-another').parent('td').addClass('nowrap');
            
            $('.filterset h3').click(function() {
                $(this).parent().toggleClass('collapse-closed');
                $(this).parent().toggleClass('collapse-open');
                $(this).next().next().toggle();
            });
            $('input.search-fields-verbose').click(function() {
                $(this).val("");
                $(this).removeClass("search-fields-verbose");
            });
            
            // SUBMIT FORM WITHOUT "RUN"-BUTTON
            $('div.actions select').change(function(){
                if ($(this).val()) {
                    $('div.changelist-content form').submit();
                }
            });
            
            // HACK: REMOVE ACTIONS and LIST_EDITABLES FOR POPUPS
            {% if is_popup %}
            $('div.actions').hide();
            $('p.submit-row').hide();
            $('input.action-select').parent().hide();
            $('input#action-toggle').parent().hide();
            {% endif %}
            
        });
    </script>

{% endblock %}

{% block bodyclass %}change-list{% endblock %}

{% block breadcrumbs %}
{% if not is_popup %}
    <div class="breadcrumbs">
        <a href="../../">{% trans "Home" %}</a>
        &rsaquo;
        <a href="../">{{ app_label|capfirst }}</a>
        &rsaquo;
        {{ cl.opts.verbose_name_plural|capfirst }}
    </div>
{% endif %}
{% endblock %}

{% block coltype %}flex{% endblock %}

{% block content %}
    <div id="content-main">
        {% block object-tools %}
            {% if has_add_permission %}
                <ul class="object-tools">
                    <li>
                        <a href="add/{% if is_popup %}?_popup=1{% endif %}" class="focus">
                            {% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}
                        </a>
                    </li>
                </ul>
            {% endif %}
        {% endblock %}
        
        {% if cl.formset.errors %}
            <p class="errornote">
            {% blocktrans count cl.formset.errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
            </p>
            <ul class="errorlist">{% for error in cl.formset.non_field_errors %}<li>{{ error }}</li>{% endfor %}</ul>
        {% endif %}
        
        <div class="module{% if cl.has_filters %} filtered{% endif %}" id="changelist">
            <div class="changelist-content">
                <form action="" method="post"{% if cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}>
                {% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
                {% if cl.formset %}
                    {{ cl.formset.management_form }}
                {% endif %}
                <div class="result-list-container">
                    {% block result_list %}
                        {% if action_form and actions_on_top and cl.full_result_count and cl.result_count %}{% admin_actions %}{% endif %}
                        {% result_list cl %}
                        {% if action_form and actions_on_bottom and cl.full_result_count and cl.result_count %}{% admin_actions %}{% endif %}
                    {% endblock %}
                    {% block pagination %}{% pagination cl %}{% endblock %}
                </div>
                {% if cl.formset and cl.result_count %}
                    <p class="submit-row">
                        <input type="submit" name="_save" class="default" value="{% trans 'Save' %}"/>
                    </p>
                {% endif %}
                </form>
            </div>
            
            {% block filters %}
                {% if cl.has_filters %}
                    <div id="changelist-filter">
                        {% block search %}{% search_form cl %}{% endblock %}
                        {% block date_hierarchy %}{% date_hierarchy cl %}{% endblock %}
                        <div class="module filter">
                            <h2>{% trans 'Filter' %}</h2>
                            {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endblock %}
        </div>
        
    </div>
{% endblock %}
